// Code generated by gen; DO NOT EDIT.
package model

import (
	"github.com/jackc/pgx/v5"
)

{{range $type, $fields := .}}

{{$objectID := $type | toLowerCamel}}
func ({{$objectID}} *{{$type}}) Table() string {
	return "{{$type | toSnake | plural}}"
}

func ({{$objectID}} *{{$type}}) Field(property string) string {
	switch property {
{{range $fields -}}
	case "{{.Property}}":
		return "{{.Column}}"
{{end -}}
	default:
		return ""
	}
}

func ({{$objectID}} *{{$type}}) Fields() []string {
	return []string{
		{{$fields | columns}}
	}
}

{{$identity := $fields | identity}}
func ({{$objectID}} *{{$type}}) Identity() string {
	return "{{$identity.Column}}"
}

func ({{$objectID}} *{{$type}}) ScanRow(rows pgx.Rows) error {
	values := rows.RawValues()
	for i, fieldDesc := range rows.FieldDescriptions() {
		v := value(values[i])
		switch fieldDesc.Name {
{{range $fields -}}
		case "{{.Column}}":
		{{if .IsPtrType -}}
			if v != nil {
			    n := v.{{.GoType | capitalize}}()
				{{$objectID}}.{{.Name}} = &n
			} else {
				{{$objectID}}.{{.Name}} = nil
			}
		{{else -}}
			{{$objectID}}.{{.Name}} = v.{{.GoType | capitalize}}()
		{{end -}}
{{end -}}
		}
	}
	return nil
}

{{$sliceType := $type | plural}}
{{$slicePtrType := join $type "Refs"}}

type {{$sliceType}} []{{$type}}
type {{$slicePtrType}} []*{{$type}}

{{$slice := $sliceType}}
func ({{$slice}} *{{$sliceType}}) NewEntity() model.Entity {
	return &{{$type}}{}
}

{{$varName := $type | toLowerCamel}}
func ({{$slice}} *{{$sliceType}}) Add(entity model.Entity) {
	{{$varName}} := entity.(*{{$type}})
	*{{$slice}} = append(*{{$slice}}, *{{$varName}})
}

func ({{$slice}} *{{$slicePtrType}}) NewEntity() model.Entity {
	return &{{$type}}{}
}

func ({{$slice}} *{{$slicePtrType}}) Add(entity model.Entity) {
	{{$varName}} := *entity.(*{{$type}})
	*{{$slice}} = append(*{{$slice}}, &{{$varName}})
}

{{$inputs := $fields | inputs}}

{{range $inputs}}
func ({{$objectID}} *{{$type}}) get{{.Name}}() any {
	{{if .IsPtrType -}}
		value := {{$objectID}}.{{.Name}}
		if value == nil {
			return nil
		}
		return {{.DbType}}(*value)
	{{else -}}
		return {{.DbType}}({{$objectID}}.{{.Name}})
	{{end -}}
}
{{end}}

func ({{$objectID}} *{{$type}}) NewEntity() model.Entity {
	return &{{$type}}{}
}

func ({{$objectID}} *{{$type}}) EnumerateFields(f func(name string, value any)) {
{{range $inputs -}}
	f("{{.Column}}", {{$objectID}}.get{{.Name}}())
{{end -}}
}

{{$inputType := join $type "Input"}}
type {{$inputType}} struct {
{{range $inputs -}}
	{{.Name}} {{.NullableType}}
{{end -}}
}

func ({{$objectID}} *{{$inputType}}) NewEntity() model.Entity {
	return &{{$type}}{}
}

func ({{$objectID}} *{{$inputType}}) EnumerateFields(f func(name string, value any)) {
{{range $inputs -}}
	if {{$objectID}}.{{.Name}}.State != None {
		f("{{.Column}}", {{$objectID}}.{{.Name}})
	}
{{end -}}
}

{{end}}
